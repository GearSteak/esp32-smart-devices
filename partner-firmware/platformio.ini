; PlatformIO Project Configuration File
;
; Translator Partner Device Firmware
; 
; This is a Meshtastic-based firmware with custom modules for:
; - Joystick input handling
; - BLE bridge to main translator device
; - Mesh message relay
;
; SETUP INSTRUCTIONS:
; 1. Clone Meshtastic firmware: git clone https://github.com/meshtastic/firmware.git
; 2. Copy this file and src/modules/* into the Meshtastic firmware directory
; 3. Copy variants/translator_partner/* to Meshtastic's variants/ directory
; 4. Build with: pio run -e translator-partner
;
; See docs/partner-device-meshtastic.md for full setup instructions.

[platformio]
default_envs = translator-partner

; ============================================================================
; Base ESP32 Configuration
; ============================================================================

[env]
platform = espressif32 @ 6.4.0
framework = arduino

; Common build flags
build_flags = 
    -Wall
    -Wextra
    -D CORE_DEBUG_LEVEL=3
    -D CONFIG_ARDUHAL_LOG_COLORS=1
    -D ARDUINO_USB_MODE=1

; Common libraries
lib_deps = 
    h2zero/NimBLE-Arduino @ ^1.4.0

monitor_speed = 115200
monitor_filters = esp32_exception_decoder, colorize

; ============================================================================
; Translator Partner Device
; ============================================================================

[env:translator-partner]
board = esp32dev
board_build.mcu = esp32
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_build.flash_mode = dio

; Partition scheme for OTA updates
board_build.partitions = min_spiffs.csv

build_flags = 
    ${env.build_flags}
    -D TRANSLATOR_PARTNER=1
    -D HAS_JOYSTICK=1
    -D HAS_MAIN_DEVICE_BRIDGE=1
    
    ; LoRa configuration
    -D USE_SX1262=1
    -D LORA_SCK=18
    -D LORA_MISO=19
    -D LORA_MOSI=23
    -D LORA_CS=5
    -D SX126X_CS=5
    -D SX126X_DIO1=26
    -D SX126X_BUSY=27
    -D SX126X_RESET=14
    
    ; Joystick configuration
    -D JOYSTICK_X_PIN=34
    -D JOYSTICK_Y_PIN=35
    -D JOYSTICK_BTN_PIN=32
    -D JOYSTICK_CENTER=2048
    -D JOYSTICK_DEADZONE=164
    -D JOYSTICK_SAMPLE_RATE_HZ=100
    -D JOYSTICK_INVERT_X=false
    -D JOYSTICK_INVERT_Y=true
    
    ; Button configuration
    -D BUTTON_HOME_PIN=33
    -D BUTTON_BACK_PIN=25
    -D BUTTON_DEBOUNCE_MS=50
    -D BUTTON_LONG_PRESS_MS=700
    -D BUTTON_DOUBLE_PRESS_MS=300
    
    ; Battery monitoring
    -D BATTERY_PIN=36
    -D ADC_MULTIPLIER=2.0
    
    ; LED
    -D LED_PIN=2
    
    ; BLE
    -D BLE_NAME=\"TransPartner\"
    
    ; Disable unused features to save flash
    -D MESHTASTIC_EXCLUDE_SCREEN=1
    -D MESHTASTIC_EXCLUDE_GPS=1

; Include variant header
build_src_filter = 
    +<*>
    +<modules/>

lib_deps = 
    ${env.lib_deps}
    jgromes/RadioLib @ ^6.4.0

upload_speed = 921600

; ============================================================================
; Development Build (more logging)
; ============================================================================

[env:translator-partner-debug]
extends = env:translator-partner

build_flags = 
    ${env:translator-partner.build_flags}
    -D CORE_DEBUG_LEVEL=5
    -D DEBUG_JOYSTICK=1
    -D DEBUG_BLE_BRIDGE=1

; ============================================================================
; Production Build (optimized)
; ============================================================================

[env:translator-partner-release]
extends = env:translator-partner

build_flags = 
    ${env:translator-partner.build_flags}
    -D CORE_DEBUG_LEVEL=1
    -O2

build_type = release

